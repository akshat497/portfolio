<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .container {
        width: max-content;
        padding: 2%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        align-self: center;
        justify-self: center;
        box-shadow: 5px 5px 22px grey;
        border-radius: 10px;
      }
      .container input {
        width: 40vh;
        height: 4vh;
      }
      .container button {
        background-color: skyblue;
        color: white;
        padding: 2%;
        border: none;
        border-radius: 5px;
      }
      #taskContainer {
        width: 50vh;
      }
      .childDiv {
        background-color: whitesmoke;
        box-shadow: 2px 2px 12px grey;
        border-radius: 10px;
        padding: 20px;
        width: max-content;
        margin: 2%;
        font-size: xx-large;
        font-weight: bolder;
        display: flex;
        justify-content: space-around;
        width: fit-content;
        gap: 10px;
        position: relative;
      }
      .tasksholder {
        width: fit-content;
      }
      .badge {
        position: absolute;
        top: 0;
        right: 0;
        margin-bottom: 2%;
        font-weight: bolder;
        color: aliceblue;
        background-color: red;
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <main>
      <div class="container">
        <h2>Todo List</h2>
        <div id="taskContainer">
          <input type="text" id="taskInput" />
          <button id="add">Add</button>
        </div>
      </div>
    </main>
    <script>
      let input = document.getElementById("taskInput"); //getting div from the id
      let container = document.querySelector(".container"); //getting div from the class thats why using th . and the querry selector
      let button = document.getElementById("add");
      var parent = document.createElement("div");
      var badge = document.createElement("div");

      badge.className = "badge";
      badge.innerText = "completed";
      parent.className = "tasksholder";
      let tasks = JSON.parse(localStorage.getItem("tasks")) ||[];

      if(tasks!=[]){
        getTasks()
      }

      //                       type of event can be click type submit doubleclick.   this is the callback function which will be executed when the click event happend
      button.addEventListener("click", () => {
        addTask();
      });
      function addTask() {
        let task = {
          id: Date.now(),
          text: input.value,
          important: false,
          complete: false,
        };

        tasks.push(task);
        localStorage.setItem("tasks",JSON.stringify(tasks))
        console.log(tasks);
        getTasks();
      }
      function getTasks() {
        parent.innerHTML = "";

        tasks.forEach((value, index) => {
          //creating buttons with javascript
          let div = document.createElement("div");
          let delButton = document.createElement("button");
          let impButton = document.createElement("button");
          let completeButton = document.createElement("button");

          //setting innertext of the buttons
          div.className = "childDiv";
          delButton.innerText = "delete";
          impButton.innerText = "*";
          completeButton.innerText = "complete";

          //del button
          delButton.style.padding = "10px";
          delButton.style.backgroundColor = "red";
          //imp button
          impButton.style.padding = "10px";
          impButton.style.backgroundColor = "lightgreen";

          div.innerHTML = value.text;

          //styling buttons with javascript
          div.style.backgroundColor = value.important ? "lightGreen" : "";
          div.style.borderLeftColor = value.important ? "darkGreen" : "";
          div.style.borderLeftWidth = "20px";

          //badge css
          badge.style.display = value.complete ? "block" : "none";

          //adding event listeners to the buttons with javascript
          delButton.addEventListener("click", () => {
            deleteTask(index);
          });
          impButton.addEventListener("click", () => {
            markImportant(value.id);
          });
          completeButton.addEventListener("click", () => {
            markComplete(value.id);
          });
          //appending elemt in the dom

          div.appendChild(impButton);
          div.appendChild(delButton);
          div.appendChild(completeButton);
          div.appendChild(badge);
          parent.appendChild(div);
          container.appendChild(parent);
        });
      }

      function deleteTask(index) {
        console.log(index);
        tasks.splice(index, 1);
        localStorage.setItem("tasks",JSON.stringify(tasks))
        console.log(tasks);
        getTasks();
      }

      function markImportant(ID) {
        debugger;
        //finding the ID that we have passed in the markimporantant function arguments in the tasks array and if the id matches then we are markign tasks.imporant key as TRUE which by default was FALSE
        let impTask = tasks.find((value) => {
          debugger;
          return value.id == ID;
        });
        impTask.important = true;
        getTasks();
      }

      const markComplete = (ID) => {
        let completedTask = tasks.find((value) => {
          debugger;
          return value.id == ID;
        });
        completedTask.complete = true;
        getTasks();
      };
    </script>
  </body>
</html>
